@{
    ViewData["Title"] = "Home Page";
}
@if (ViewBag.Year != null && ViewBag.Day != null)
{
    <div class="d-flex">
        <div class="h4">@ViewBag.Season @(ViewBag.Day), Year @ViewBag.Year</div>
        <button type="button" id="add-crop-btn" class="btn btn-primary ms-auto" data-bs-toggle="modal" data-bs-target="#staticModalLg">Add Crop</button>
    </div>
    <div class="mt-3 card card-body">
        <div class="h5 mb-2">To-Do</div>
        @if (ViewBag.HasFarmAnimals)
        {
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="animalCheck">
                <label class="form-check-label" for="animalCheck">
                    Pet farm animals
                </label>
            </div>
        }
        @if (ViewBag.HasPet)
        {
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="petCheck">
                <label class="form-check-label" for="petCheck">
                    Feed pet
                </label>
            </div>
        }
        @if (ViewBag.Harvest.Count > 0)
        {
            <div class="mt-2">
                <div class="fw-lightbold mb-1">Harvests:</div>
				<div class="ms-3 harvest-checks">
					@foreach (GrowingCropViewModel crop in ViewBag.Harvest)
					{
                        <div class="form-check" data-grow="@crop.Id" data-id="@crop.CropId">
							<input class="form-check-input" type="checkbox" value="">
							<label class="form-check-label" for="petCheck">
								@crop.CropName
							</label>
						</div>
					}
				</div>
                
            </div>
        }
    </div>
    <div class="d-flex justify-content-between mt-4">
        <button id="btn-prev" class="btn btn-outline-secondary" disabled><i class="fas fa-arrow-left me-2"></i>Previous Day</button>
        <button id="btn-next" class="btn btn-secondary" onclick="nextDay(@ViewBag.Harvest.Count)">Next Day<i class="fas fa-arrow-right ms-2"></i></button>
    </div>
}

<script>
    $(".btn-primary").click((e) => {
        $("#staticModalLgBody").html(spinner);
        $("#staticModalLgBody").load("/Crop/Add");
    })

    function nextDay(count) {
        if (count > 0) {
            var checks = [];
            $('.harvest-checks').children().each(function(idx, e) {
                let data = {
                    GrowingCropId: $(e).data('grow'),
                    CropId: $(e).data('id'),
                    IsHarvested: $(e).children('.form-check-input').is(':checked')
                };
                checks.push(data);
            })
            console.log(checks);
            let harvestChecks = JSON.stringify(checks);
            console.log(harvestChecks);

            $.ajax({
                url: '/Home/NextDayHarvest',
                data: { 'harvestChecks': checks },
                type: 'post',
                dataType: 'json',
                success: (response) => {
                    if (response.statusCode == 200) {
                        location.href = '/Home/NextDay';

                    }
                    else {
                        debugger;
                    }
                }
            })
        }
        else {
            location.href = '/Home/NextDay';
        }
    }
</script>