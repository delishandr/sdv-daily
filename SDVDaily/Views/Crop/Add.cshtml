@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model List<CropViewModel>
@{
    Layout = null;
}

<div>
    <div class="card card-body">
        <form id="frmAddCrop">
            <div class="row align-items-center">
                <div class="col-2">
                    <span>Crop</span>
                </div>
                <div class="col-10">
                    <select id="cropSelect" class="form-select" aria-label="Crop select">
                        <option value="">-- Select crop --</option>
                        @foreach (CropViewModel crop in Model)
                        {
                            if (crop.Seasons.Any(s => s.Id == ViewBag.CurSeason))
                            {
                                <option value="@crop.Id">@crop.Name</option>
                            }
                        }
                    </select>
                </div>
            </div>
            <div class="m-3 row">
                <div class="form-check col-4">
                    <input class="form-check-input" type="checkbox" value="" id="onGingerCheck">
                    <label class="form-check-label" for="flexCheckDefault">
                        On Ginger Island
                    </label>
                </div>
                <div class="form-check col-4">
                    <input class="form-check-input" type="checkbox" value="" id="indoorsCheck">
                    <label class="form-check-label" for="flexCheckDefault">
                        Indoors
                    </label>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    $('#staticModalLgLabel').text("@ViewBag.Title");

    $('#onGingerCheck').click(function(e) {
        if ($(this).prop("checked")) {
            $('#indoorsCheck').prop("checked", false);
            getCrops('ginger');
        }
        else {
            getCrops('season');
        }
    })

    $('#indoorsCheck').click(function (e) {
        if ($(this).prop("checked")) {
            $('#onGingerCheck').prop("checked", false);
            getCrops('all');
        }
        else {
            getCrops('season');
        }
    })

    function getCrops(category) {
        $.ajax({
            url: "/Crop/GetCropsBy",
            data: {
                category: category
            },
            dataType: "json",
            beforeSend: () => { },
            success: (response) => {
                console.log(response)
                if (response.length > 0) {
                    $("#cropSelect").empty();
                    $("#cropSelect").append(`<option value="">-- Select crop --</option>`);
                    $.each(
                        response,
                        function (idx, data) {
                            $("#cropSelect").append(
                                `<option value="${data.id}">${data.name}</option>`
                            );
                        }
                    );
                }
            },
            error: (errResponse) => {
                console.error(errResponse);
            }

        })
    }
</script>