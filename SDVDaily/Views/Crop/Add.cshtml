@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model List<CropViewModel>
@{
    Layout = null;
}

<div>
    <div class="card card-body">
        <form id="frmAddCrop">
            <div class="row align-items-center">
                <div class="col-8">
                    <div class="fw-lightbold mb-2">Crop</div>
                    <div class="ps-0">
                        <select id="cropSelect" name="CropId" class="form-select" aria-label="Crop select">
                            <option value="">-- Select crop --</option>
                            @foreach (CropViewModel crop in Model)
                            {
                                if (crop.Seasons.Any(s => s.Id == ViewBag.CurSeason))
                                {
                                    <option value="@crop.Id">@crop.Name</option>
                                }
                            }
                        </select>
                    </div>
                </div>
                <div class="col-4">
                    <div class="fw-lightbold mb-2">Amount</div>
                    <div>
                        <input type="number" class="form-control" id="amount" name="Amount" min="1">
                    </div>
                </div>
            </div>
            <div class="m-3 row">
                <div class="form-check col-4">
                    <input class="form-check-input" type="checkbox" value="" id="onGingerCheck" name="IsOnGinger">
                    <label class="form-check-label" for="onGingerCheck">
                        On Ginger Island
                    </label>
                </div>
                <div class="form-check col-4">
                    <input class="form-check-input" type="checkbox" value="" id="indoorsCheck" name="IsIndoors">
                    <label class="form-check-label" for="indoorsCheck">
                        Indoors
                    </label>
                </div>
            </div>

            <div class="row my-3">
                <div class="col-3">
                    <div class="fw-lightbold mb-2">Profession</div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" value="" id="agriculturist" name="IsAgriculturist">
                        <label class="form-check-label" for="agriculturist">
                            Agriculturist
                        </label>
                    </div>
                </div>
                <div class="col-9">
                    <div class="fw-lightbold mb-2">Fertilizer</div>
                    <div class="row ms-1">
                        <div class="form-check col-lg-4">
                            <input class="form-check-input fertilizerCheck" type="checkbox" value="" id="sgCheck" name="IsSG">
                            <label class="form-check-label" for="sgCheck">
                                Speed-Gro
                            </label>
                        </div>
                        <div class="form-check col-lg-4">
                            <input class="form-check-input fertilizerCheck" type="checkbox" value="" id="dsgCheck" name="IsDSG">
                            <label class="form-check-label" for="dsgCheck">
                                Deluxe Speed-Gro
                            </label>
                        </div>
                        <div class="form-check col-lg-4">
                            <input class="form-check-input fertilizerCheck" type="checkbox" value="" id="hsgCheck" name="IsHSG">
                            <label class="form-check-label" for="hsgCheck">
                                Hyper Speed-Gro
                            </label>
                        </div>

                    </div>
                </div>
            </div>

        </form>
    </div>
    <div class="d-flex justify-content-end gap-2 mt-3">
        <button class="btn btn-secondary">Cancel</button>
        <button id="btn-add" class="btn btn-primary">Add</button>
    </div>
</div>

<script>
    $('#staticModalLgLabel').text("@ViewBag.Title");

    $('#onGingerCheck').click(function(e) {
        if ($(this).prop("checked")) {
            $('#indoorsCheck').prop("checked", false);
            getCrops('ginger');
        }
        else {
            getCrops('season');
        }
    })

    $('#indoorsCheck').click(function (e) {
        if ($(this).prop("checked")) {
            $('#onGingerCheck').prop("checked", false);
            getCrops('all');
        }
        else {
            getCrops('season');
        }
    })

    function getCrops(category) {
        $.ajax({
            url: "/Crop/GetCropsBy",
            data: {
                category: category
            },
            dataType: "json",
            beforeSend: () => { },
            success: (response) => {
                    if (response.data.length > 0) {
                    $("#cropSelect").empty();
                    $("#cropSelect").append(`<option value="">-- Select crop --</option>`);
                    $.each(
                        response.data,
                        function (idx, data) {
                            $("#cropSelect").append(
                                `<option value="${data.id}">${data.name}</option>`
                            );
                        }
                    );
                }
            },
            error: (errResponse) => {
                console.error(errResponse);
            }

        })
    }

    $('.fertilizerCheck').click((e) => {
        if ($(e.target).attr('id') != 'sgCheck') {
            $('#sgCheck').prop("checked", false);
        }
        if ($(e.target).attr('id') != 'dsgCheck') {
            $('#dsgCheck').prop("checked", false);
        }
        if ($(e.target).attr('id') != 'hsgCheck') {
            $('#hsgCheck').prop("checked", false);
        }
    })

    $("#btn-add").click((e) => $("#frmAddCrop").submit());

    $("#frmAddCrop").submit(function (e) {
        e.preventDefault();
        if ($("#frmAddCrop").valid()) {
            $.ajax({
                url: "/Crop/Add",
                type: "post",
                data: $("#frmAddCrop").serialize(),
                dataType: "json",
                success: (response) => {
                    if (response.statusCode == 200 || response.statusCode == 201) {
                        location.reload();
                    }
                },
                error: (errResponse) => {
                    console.error(errResponse);
                    debugger;
                }
            });
        }
        else {
            console.error("Data is not valid!");
        }
    })

    $('#frmAddCrop').validate({
        rules: {
            CropId: "required",
            Amount: {
                required: true,
                min: 1
            }
        }
    })
</script>